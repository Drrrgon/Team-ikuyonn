<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.ikuyonn.project.uProject.mapper.ProjectMapper">
	<delete id="deleteProject" parameterType="int">
		delete from project where projectSeq = #{value}
	</delete>
	
	<delete id="deleteJoinProject" parameterType="map">
		delete from joinProject 
			where 
			projectSeq = #{projectSeq}				
	</delete>
	
	<select id="getUserProjectList" parameterType="map" resultType="Project">		
		<if test="userID != null">
		SELECT DISTINCT 
			p.projectName, p.projectSeq, p.memberNum memberNum, p.due, p.projectMaster, p.color
		FROM 
			project p, joinProject jp, userTable ut 
		WHERE 
			#{userID} = jp.userID 
			AND 
			jp.projectSeq = p.projectSeq
		ORDER BY p.projectSeq
		</if>			
		<if test="userID == null">
			SELECT * FROM project
			ORDER BY projectSeq
		</if>	
	</select>
	
	<!-- <select id="getprojectList" parameterType="map" resultType="project">		
		<if test="userID != null">
		SELECT DISTINCT 
			p.projectName, p.projectSeq, p.due 
		FROM 
			project p, joinProject jp, usertable ut 
		WHERE 
			#{userID} = jp.userID 
			AND 
			jp.projectName = p.projectName
			AND
			#{projectName} = p.projectName
		</if>			
		<if test="userID == null">
			SELECT * FROM project
		</if>	
	</select> -->
	
	<insert id="createProject" parameterType="Project">
		INSERT INTO project
		VALUES
			(null,
			#{projectMaster},
			#{projectName},
			#{due},
			null,
			#{color}
			)
		<selectKey keyProperty="projectSeq" resultType="Integer" order="AFTER">

		SELECT LAST_INSERT_ID() FROM dual

		</selectKey>
	</insert>
	
	<insert id="joinProject" parameterType="map">
		INSERT INTO joinProject
		VALUES
			(#{userID},
			#{projectSeq}
			)
	</insert>
	<select id="getCountOfProjectMember" parameterType="int" resultType="map">
		SELECT COUNT(userID) memberNum 
		FROM joinProject 
		WHERE projectSeq = #{VALUE}
	</select>
	
	<select id="getProjectMemeber" parameterType="int" resultType="map">
		SELECT userID FROM joinProject WHERE projectSeq = #{VALUE}
	</select>
	
	<update id="updateCountOfProjectMember" parameterType="map">
		UPDATE project
		SET memberNum = #{memberNum}
		WHERE projectSeq = #{projectSeq}
	</update>
	
	<update id="updateProjectName" parameterType="map">
		UPDATE project
		SET projectName = #{projectName}
		WHERE projectSeq = #{projectSeq}
	</update>
	
	<delete id="secessionProjectMember" parameterType="map">
		DELETE FROM joinProject
		WHERE 
			projectSeq = #{projectSeq}
			AND
			userID = #{userID}
	</delete>
	
	<select id="checkProjectMaster" parameterType="map" resultType="string">
		SELECT projectMaster FROM project WHERE projectSeq = #{projectSeq}
	</select>
</mapper>
