<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.ikuyonn.project.socket.mapper.Mapper">
	<select id="getRoomContent" parameterType="string" resultType="table">
		select id, message, to_char(datetime, 'YY-MM-DD HH24:MI:SS') datetime
		from message
		where roomNum = #{roomNum}
	 	AND
				 to_char(datetime, 'DD') = to_char(sysdate, 'DD')
		order by seq desc
		
	</select>
	
	<insert id="insertContent" parameterType="table" >
		INSERT INTO message
			VALUES( message_seq.nextVal
					, #{message}
					, #{id}
					, #{roomnum}
					, sysdate)
	</insert>
	<select id="searchByDate" parameterType="map" resultType="table">
		SELECT id, message, to_char(datetime, 'YY-MM-DD HH24:MI:SS') datetime
		FROM message
		WHERE roomNum = #{roomnum}
	 	AND
				 to_char(datetime, 'YYYY-MM-DD') = #{date}
		order by seq desc 	
	</select>
<!--  for maria db -->
	<!-- <select id="getRoomContent" parameterType="string" resultType="table">
		select id, message, date_format(date, "%Y-%m-%d %H:%i:%S") date
		from message
		where roomNum = #{roomNum} AND
				date_format(date, "%d") = date_format(now(), "%d")
		order by seq desc
		limit 125
	</select>
	
	<insert id="insertContent" parameterType="table" >
		INSERT INTO message
			VALUES( null
					, #{message}
					, #{id}
					, #{roomnum}
					, now())
	</insert> -->
</mapper>
